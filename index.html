<!DOCTYPE html>
<html>
	<head>
    <meta charset="utf-8" />
		<title>FSM per SVG</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
	</head>
	<body>

    <div class="explaination">
      <h1>PLA</h1>

      <p>
        Below you should see a simple logic circuit which has been generated via svg.
      </p>
      <p>
        You can drag to move the camera. Scroll to zoom.
      </p>
    </div>

    <svg id="stage"></svg>

    <script type="text/javascript" src="common.js"></script>
    <script type="text/javascript" src="gates.js"></script>
    <script type="text/javascript">
      var setup = function(stage) {
        var states = {};
        var cam = createCamera();

        var doRender = function() {
          var width = parseInt(stage.getAttribute('width'), 10);
          var height = parseInt(stage.getAttribute('height'), 10);

          clearSVG(stage);
          stage.setAttribute('viewBox', [
            cam.x - width/cam.zoom/2,
            cam.y - height/cam.zoom/2,
            width/cam.zoom,
            height/cam.zoom
          ].join(' '));

          appendToSVG(stage,'rect',{
            x: cam.x - width/cam.zoom/2,
            y: cam.y - height/cam.zoom/2,
            width: width/cam.zoom,
            height: height/cam.zoom,
            class: 'background'
          });

          logicGates.xor(stage, -200, -40);
          logicGates.xnor(stage, -200, 40);
          logicGates.or(stage, -50, -40);
          logicGates.nor(stage, -50, 40);
          logicGates.and(stage, 100, -40);
          logicGates.nand(stage, 100, 40);
          logicGates.not(stage, 250,  40);

        };

        var render = makeRenderer(doRender, true);

        var eventToCursorPosition = (function() {
          var pt = stage.createSVGPoint();

          return function(evt){
            pt.x = evt.clientX;
            pt.y = evt.clientY;
            return pt.matrixTransform(stage.getScreenCTM().inverse());
          };
        })();

        var panHandler = createPanHandler(cam, render, createDynamicClamper(1200, 600));

        var hitTest = function(evt, pos) {
          var idx = evt.target.getAttribute('stateIdx');
          return idx ? parseInt(idx, 10) : null;
        };

        var onZoom = createZoomHandler(cam, render, 0.3, 2, panHandler);

        var onDoubleClick = function(evt, pos) {
          cam.zoom = 0.7;
          cam.x = 0;
          cam.y = 0;

          render();
        };

        var dragHandler = createDragHandler(render, panHandler);

        var dragState = setupMouseHandler(stage, eventToCursorPosition, dragHandler, onZoom, onDoubleClick);

        return function() {
          setStageSize(stage, 1200, 600);
          render();
        };
      };

      var renderer = setup(document.getElementById('stage'));
      renderer();
    </script>
	</body>
</html>
